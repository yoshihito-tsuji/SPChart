# CLAUDE.md - SPChart プロジェクト Claude Code 指示書

## プロジェクト概要

**SPChart** は、S-P表（Student-Problem表）理論に基づく教育測定ツールです。テスト結果の二値データを視覚的・統計的に分析し、生徒の学習課題や問題の適切性を把握できるWebアプリケーションを目指します。

## 三者間協働開発モデル

### 役割定義

| 役割 | 担当 | 責務 |
|------|------|------|
| **プロジェクトオーナー** | Yoshihitoさん | 最終意思決定、企画・要件定義、プロジェクト管理 |
| **アーキテクト** | Codex | 設計・アーキテクチャ策定、技術方針決定、設計レビュー |
| **実装エンジニア** | Claude Code | コード実装、品質管理、テスト、技術課題の報告 |

### 意思決定優先順位

1. **Yoshihitoさんの意図・要望が最優先**
2. Codexのアーキテクチャ・設計方針
3. 技術的なベストプラクティス

### コミュニケーション規則

AI同士（Codex ↔ Claude Code）の通信には **From/To形式** を使用：

```
From: Claude Code
To: Codex

[本文]
```

```
From: Claude Code
To: Yoshihitoさん

[本文]
```

## プロジェクト構成

```
SPChart/
├── README.md              # プロジェクト概要
├── CLAUDE.md              # 本ファイル
├── Codex.md               # Codex向け指示書
├── DECISIONS.md           # 確定事項一覧
├── docs/                  # ドキュメント
│   ├── team_ops/          # チーム運用
│   ├── engineering/       # 技術ドキュメント
│   ├── product/           # プロダクト仕様
│   └── research/          # S-P表理論調査
├── LOG/                   # 日次開発ログ
├── frontend/              # Reactアプリケーション
└── .claude/               # Claude Code設定
```

## 開発ルール

### ログ管理

- **ファイル形式**: `LOG/YYYY-MM-DD.md`
- **ログ番号**: `LOG_00001` 形式（5桁ゼロパディング、通し番号）
- **セクション種別**:
  - `[PROPOSAL]` - 設計案、実装方針
  - `[REVIEW]` - コードレビュー、テスト結果
  - `[PLAN]` - タスクリスト、開発ステップ
  - `[RUNLOG]` - 実装内容、変更ファイル
  - `[DECISION]` - 重要決定事項

### コードレビュー自動実施条件

以下の場合、code-reviewerエージェントを起動：

- 3ファイル以上の変更
- 100行以上の変更
- セキュリティ関連ファイルの変更

### コミットメッセージ規則

- **言語**: 日本語
- **プレフィックス**:
  - `Add:` 新機能追加
  - `Update:` 既存機能改善
  - `Fix:` バグ修正
  - `Refactor:` リファクタリング
  - `Docs:` ドキュメント更新

## S-P表 技術仕様

### データ構造

入力データは N人の生徒 × n個の問題 の二値行列：

```typescript
interface SPTableData {
  students: string[];      // 生徒ID一覧
  problems: string[];      // 問題ID一覧
  matrix: number[][];      // 正答(1)/誤答(0)の行列
}
```

### 並べ替え規則

1. **縦軸（生徒）**: 合計得点の高い順（上→下）
2. **横軸（問題）**: 正答者数の多い順（左→右）

### 注意係数の計算

**生徒の注意係数（CS）**:

```
CS_i = (A - B) / (C - D × E)

A: S曲線より左側の誤答に対応する項目の正答者数の和
B: S曲線より右側の正答に対応する項目の正答者数の和
C: S曲線より左側の項目の正答者数の和
D: 生徒iの合計得点
E: 全項目の正答者数の平均
```

**判定基準**:
- 0.5以上: 要注意
- 0.75以上: 特に注意

### 曲線定義

- **S曲線**: 各生徒について、左から正答数分のセルを数えた位置を結ぶ階段状折れ線
- **P曲線**: 各問題について、上から正答者数分のセルを数えた位置を結ぶ折れ線

## セッション開始手順

1. `README.md` を確認
2. `CLAUDE.md`（本ファイル）を確認
3. `Codex.md` で設計方針を確認
4. 最新の `LOG/YYYY-MM-DD.md` を確認
5. `DECISIONS.md` で確定事項を確認

## 技術スタック

- **フロントエンド**: React 19 + TypeScript + Vite
- **可視化**: ECharts または D3.js
- **スタイリング**: Tailwind CSS
- **配布形式**: Webアプリ（PWA対応予定）

## 品質基準

### セキュリティ

- ユーザー入力は必ずバリデーション
- 認証情報はハードコードしない

### エラーハンドリング

- ファイル読込エラーの適切な処理
- ゼロ除算の例外処理（注意係数計算時）

### UX原則

- 認知負荷の最小化
- 0.4秒以内のフィードバック
- 視覚的階層の明確化
